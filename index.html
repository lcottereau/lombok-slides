<!doctype html>
<html lang="fr">

	<head>
		<meta charset="utf-8">

		<title>Les «&#8239;design patterns&#8239;» clés en main avec Lombok. La maintenabilité en bonus.</title>

		<meta name="description" content="Une présentation sur la bibliothèque d'injection de design patterns en java, Lombok">
		<meta name="author" content="Laurent Cottereau">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="reveal/css/reveal.min.css">
		<link rel="stylesheet" href="reveal/css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="reveal/lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'reveal/css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="reveal/lib/js/html5shiv.js"></script>
		<![endif]-->

		<style>
		    li.email {
		        list-style-image: url('img/icon-email.png');
		    }
		    li.linkedin {
		        list-style-image: url('img/icon-linkedin.png');
		    }
		    li.twitter {
		        list-style-image: url('img/icon-twitter.png');
		    }
		    li.github {
		        list-style-image: url('img/icon-github.png');
		    }
		    .reveal a:not(.image) {
		        color: white;
		    }
		    .reveal a:not(.image):hover {
		        text-decoration: underline;
		    }
		    html.light-background .present {
		    	background-color: rgba(0, 0, 0, 0.8);
		    	border-radius: 10px;
		    }
		    html.code-extracts img {
		    	vertical-align: top;
		    	width: 2.5em;
		    }
		</style>
	</head>

	<body>

		<div class="reveal">

			<div class="slides">
				<section data-background="img/slide-lombok.jpg">
					<h1>Lombok</h1>
					<p>Les «&#8239;<span lang="en">design patterns</span>&#8239;» clés en main</p>
					<p>La maintenabilité en bonus</p>
					<aside class="notes">
						<ul>
							<li>Qui a fait du <acronym lang="en" title="Create, Read, Update, Delete">CRUD</acronym> ou du MVC à la main dans la dernière année ?</li>
							<li>Qui a écrit un getter ou un setter à la main dans la dernière année ?</li>
							<li>Qui ici trouve ça pénible ?</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-problems.jpg" data-state="light-background">
					<p>Nous avons tous les mêmes problèmes</p>
					<aside class="notes">
						<ul>
							<li>Pas la multiplication de chatons : avis partagés</li>
							<li>Se concentrer sur ce qui nécessite de la créativité</li>
							<li>Aux problèmes <em>classiques</em> des solutions <em>classiques</em></li>
							<li>Les design patterns (motifs d'architecture logicielle)</li>
							<li>Je ne veux pas y passer de temps</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-books.jpg" data-state="light-background">
					<p>La différence entre le bon développeur et le mauvais développeur...</p>
					<aside class="notes">
						<ul>
							<li><em>J'ai un ami</em> étudiant développeur qui a eu des cours</li>
							<li>Pénible, rébarbatif et abstrait (faute des profs ?)</li>
							<li>Ce n'est pas moi, c'est un pote</li>
							<li>Quand même diplômé et travail concret</li>
							<li>Pas besoin de patterns ? (patterns de sécu)</li>
							<li>Consensus du monde professionel, standards (beans)
								<ul>
									<li><a hreflang="en" href="http://www.artima.com/lejava/articles/equality.html">vos méthodes <code>equals</code> et héritage</a></li>
									<li>penser à utiliser <code>@ConstructorProperties</code></li>
									<li>gérer le <span lang="en">thread-safe</span> sur un calcul d'attribut à la demande</li>
								</ul>
							</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-outillage.jpg" data-state="light-background">
					<p>Outillage</p>
					<aside class="notes">
						<ul>
							<li>Recopie depuis livres, par coeur : insupportable car feignant</li>
							<li>IDE a proposé la génération de getters</li>
							<li>remaniement difficile</li>
							<li>guava propose <code>Objects</code> (apache-commons, java 7)</li>
							<li>plomberie apparente</li>
							<li>lombok propose des annotations, codé à la compilation</li>
							<li>pour du bas-niveau (on a déjà des frameworks pour l'archi globale)</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-large.jpg">
					<h2>Un cas typique</h2>
					<pre><code>
/**
 * Copyright Sénat.
 */
package fr.senat.model.dosleg;

import fr.senat.model.dosleg.validator.ActiviteValide;
import fr.senat.model.senateurs.GroupePolitique;
import fr.senat.util.Constants;
import java.io.Serializable;
import java.util.HashSet;
import java.util.Set;
import javax.persistence.CascadeType;
import javax.persistence.Column;
import javax.persistence.Embedded;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.JoinTable;
import javax.persistence.ManyToMany;
import javax.persistence.ManyToOne;
import javax.persistence.OneToMany;
import javax.persistence.OrderBy;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Pattern;
import javax.validation.constraints.Size;
import org.hibernate.annotations.Type;
import static org.joda.time.DateTimeConstants.OCTOBER;
import org.joda.time.LocalDate;
import static org.joda.time.LocalDate.now;

/**
 * Représente une mission de contrôle et d'évaluation du Sénat. Peut être une Mission Commune d'Information, une
 * commission d'enquête, un contrôle d'application d'une loi, un contrôle de commission permanente, etc... Par défaut,
 * le contrôle n'est à l'initiative des groupes, ni avec l'aide de la cour des comptes ou clôturé, mais il est considéré
 * comme avec rapport. Par ailleurs, les organismes, lois, livrables, acteurs et thèmes sont des ensembles vides.
 */
@Entity
@ActiviteValide
public class Controle implements Serializable {
    private static final String FOREIGN_KEY_ID = "CON_ID";
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Integer id;
    @Size(max = 256, message = "trop long.")
    @Column(name = "LIB", length = 256)
    @NotNull
    private String libelle;
    @Size(max = 2048, message = "trop long.")
    private String objet;
    @Pattern(regexp = Constants.URL_PATTERN, message = "pas au bon format (par exemple : http://www.senat.fr/commission/XX/missions_d_information/mission_dinformation_sur_YY.html)")
    private String url;
    @NotNull
    @Column(name = "INITIATIVE_GROUPES")
    @Type(type = "fr.senat.util.hibernate.usertype.OuiNonSmallType")
    private boolean initiativeDesGroupes = false;
    @NotNull
    @Column(name = "COUR_COMPTES")
    @Type(type = "fr.senat.util.hibernate.usertype.OuiNonSmallType")
    private boolean courDesComptes = false;
    @NotNull
    @Column(name = "PROGRAMME_CREATION")
    private int programmeCreation = Controle.getSession(now());
    @Column(name = "PROGRAMME_REPORT")
    private Integer programmeReport;
    @Column(name = "DATE_CREATION")
    @Type(type = "org.jadira.usertype.dateandtime.joda.PersistentLocalDate")
    private LocalDate dateCreation;
    @NotNull
    @Type(type = "fr.senat.util.hibernate.usertype.OuiNonSmallType")
    private boolean cloture = false;
    @NotNull
    @Column(name = "AVEC_RAPPORT")
    @Type(type = "fr.senat.util.hibernate.usertype.OuiNonSmallType")
    private boolean avecRapport = true;
    @Embedded
    @NotNull
    private EcheanceControle echeance = new EcheanceControle();
    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "GRPPOL")
    private GroupePolitique groupePolitique;
    @ManyToMany
    @JoinTable(name = "CONTROLE_ORG", joinColumns = @JoinColumn(name = FOREIGN_KEY_ID), inverseJoinColumns = @JoinColumn(name = "ORGCOD"))
    private Set&lt;Organisme&gt; organismes = new HashSet&lt;Organisme&gt;();
    @ManyToMany
    @JoinTable(name = "CONTROLE_LOI", joinColumns = @JoinColumn(name = FOREIGN_KEY_ID), inverseJoinColumns = @JoinColumn(name = "LOICOD"))
    private Set&lt;Loi&gt; lois = new HashSet&lt;Loi&gt;();
    @OneToMany(orphanRemoval = true, cascade = CascadeType.ALL)
    @JoinColumn(name = FOREIGN_KEY_ID, nullable = false)
    private Set&lt;LivrableControle&gt; livrables = new HashSet&lt;LivrableControle&gt;();
    @OneToMany(orphanRemoval = true, cascade = CascadeType.ALL)
    @JoinColumn(name = FOREIGN_KEY_ID, nullable = false)
    @OrderBy("id asc")
    private Set&lt;ActeurControle&gt; acteurs = new HashSet&lt;ActeurControle&gt;();
    private final java.util.concurrent.AtomicReference&lt;java.lang.Object&gt; themes = new java.util.concurrent.AtomicReference&lt;java.lang.Object&gt;();


    public Controle() {
    }

    public Integer getId() {
        return this.id;
    }

    public String getLibelle() {
        return this.libelle;
    }

    public String getObjet() {
        return this.objet;
    }

    public String getUrl() {
        return this.url;
    }

    public boolean isInitiativeDesGroupes() {
        return this.initiativeDesGroupes;
    }

    public boolean isCourDesComptes() {
        return this.courDesComptes;
    }

    public int getProgrammeCreation() {
        return this.programmeCreation;
    }

    public Integer getProgrammeReport() {
        return this.programmeReport;
    }

    public LocalDate getDateCreation() {
        return this.dateCreation;
    }

    public boolean isCloture() {
        return this.cloture;
    }

    public boolean isAvecRapport() {
        return this.avecRapport;
    }

    public EcheanceControle getEcheance() {
        return this.echeance;
    }

    public GroupePolitique getGroupePolitique() {
        return this.groupePolitique;
    }

    public Set&lt;Organisme&gt; getOrganismes() {
        return this.organismes;
    }

    public Set&lt;Loi&gt; getLois() {
        return this.lois;
    }

    public Set&lt;LivrableControle&gt; getLivrables() {
        return this.livrables;
    }

    public Set&lt;ActeurControle&gt; getActeurs() {
        return this.acteurs;
    }

    public Set&lt;Theme&gt; getThemes() {
        java.lang.Object value = this.themes.get();
        if (value == null) {
            synchronized(this.themes) {
                value = this.themes.get();
                if (value == null) {
                    final Set&lt;Theme&gt; actualValue = Cache.getInstance().calculateThemes();
                    value = actualValue == null ? this.themes : actualValue;
                    this.themes.set(value);
                }
            }
        }
        return (Set&lt;Theme&gt;)(value == this.themes ? null : value);
     }

    public void setId(final Integer id) {
        this.id = id;
    }

    public void setLibelle(final String libelle) {
        this.libelle = libelle;
    }

    public void setObjet(final String objet) {
        this.objet = objet;
    }

    public void setUrl(final String url) {
        this.url = url;
    }

    public void setInitiativeDesGroupes(final boolean initiativeDesGroupes) {
        this.initiativeDesGroupes = initiativeDesGroupes;
    }

    public void setCourDesComptes(final boolean courDesComptes) {
        this.courDesComptes = courDesComptes;
    }

    public void setProgrammeCreation(final int programmeCreation) {
        this.programmeCreation = programmeCreation;
    }

    public void setProgrammeReport(final Integer programmeReport) {
        this.programmeReport = programmeReport;
    }

    public void setDateCreation(final LocalDate dateCreation) {
        this.dateCreation = dateCreation;
    }

    public void setCloture(final boolean cloture) {
        this.cloture = cloture;
    }

    public void setAvecRapport(final boolean avecRapport) {
        this.avecRapport = avecRapport;
    }

    public void setEcheance(final EcheanceControle echeance) {
        this.echeance = echeance;
    }

    public void setGroupePolitique(final GroupePolitique groupePolitique) {
        this.groupePolitique = groupePolitique;
    }

    public void setOrganismes(final Set&lt;Organisme&gt; organismes) {
        this.organismes = organismes;
    }

    public void setLois(final Set&lt;Loi&gt; lois) {
        this.lois = lois;
    }

    public void setLivrables(final Set&lt;LivrableControle&gt; livrables) {
        this.livrables = livrables;
    }

    public void setActeurs(final Set&lt;ActeurControle&gt; acteurs) {
        this.acteurs = acteurs;
    }

    public void setThemes(final Set&lt;Theme&gt; themes) {
        this.themes = themes;
    }
    
    /**
     * Renvoie la date à prendre en compte pour le nommage du groupe politique lié à ce contrôle. TODO vérifier cette
     * règle de gestion avec S. Dubourg.
     *
     * @return la date à prendre en compte.
     */
    private LocalDate getDateNommageGroupePolitique() {
        if (isClosed()) {
            return echeance.getDate();
        } else {
            return LocalDate.now();
        }
    }

    /**
     * Renvoie le libellé de groupe politique à la date adéquate pour ce contrôle, préfixé de l'article adéquat. Ainsi,
     * un contrôle en cours prendra le nom à la date du jour alors qu'un contrôle fini prendra le nom à la date
     * d'échéance.
     *
     * @return le libellé préfixé de l'article. &lt;code&gt;null&lt;/code&gt; si le groupe politique n'est pas défini.
     */
    public String getLibelleLongEtArticleGroupePolitique() {
        if (groupePolitique != null) {
            LocalDate d = getDateNommageGroupePolitique();
            StringBuilder sb = new StringBuilder(groupePolitique.getArticle(d));
            sb.append(" ");
            sb.append(groupePolitique.getLibelleLong(d));
            return sb.toString();
        }
        return null;
    }

    /**
     * Détermine si le contrôle est fini.
     *
     * @return &lt;code&gt;true&lt;/code&gt; si le contrôle est fini.
     */
    public boolean isClosed() {
        return echeance != null && echeance.getDate().isBefore(LocalDate.now());
    }

    /**
     * Reporte d'un an le contrôle. La date de début d'activité est inchangée mais la date de report est décalée d'un an
     * (année suivant le démarrage si c'est le premier report)
     */
    public void reporter() {
        if (canReporteControle()) {
            if (programmeReport == null) {
                programmeReport = programmeCreation + 1;
            } else {
                programmeReport++;
            }
        }
    }

    /**
     * Renvoie le dernier programme d'activité du contrôle.
     *
     * @return le dernier programme d'activité du contrôle.
     */
    public int getDernierProgramme() {
        if (programmeReport == null) {
            return programmeCreation;
        } else {
            return programmeReport;
        }
    }

    /**
     * Indique si un contrôle peut être reporté. C'est le cas si l'échéance correspond à une session strictement
     * postérieure supérieure à la session de report actuelle.
     *
     * @return &lt;code&gt;true&lt;/code&gt; si le contrôle peut être reporté. &lt;code&gt;false&lt;/code&gt; sinon.
     */
    public boolean canReporteControle() {
        if (echeance.getDate() != null) {
            return (getDernierProgramme() &lt; echeance.getSession());
        } else {
            return false;
        }
    }

    /**
     * Renvoie la session correspondant à une date.
     *
     * @param date la date dont on cherche la session.
     * @return la session, représentée par l'année de démarrage de la session (2013 pour la session 2013-2014 par
     * exemple). &lt;code&gt;null&lt;/code&gt; si la date en paramètre est nulle.
     */
    public static Integer getSession(LocalDate date) {
        if (date != null) {
            if (date.getMonthOfYear() &lt; OCTOBER) {
                return date.getYear() - 1;
            } else {
                return date.getYear();
            }
        } else {
            return null;
        }
    }

    /**
     * Renvoie l'année de fin d'activité du contrôle.
     *
     * @return l'année de fin d'activité.
     */
    public int getFinActivite() {
        return getDernierProgramme() + 1;
    }

    /**
     * Définit la fin d'activité. Calcule le programme correspondant et définit éventuellement un report sur le
     * contrôle.
     *
     * @param fin l'année de fin d'activité spécifiée dans le formulaire.
     */
    public void setFinActivite(int fin) {
        if (fin &gt; getProgrammeCreation() + 1) {
            setProgrammeReport(fin - 1);
        } else {
            setProgrammeReport(null);
        }
    }

    @java.lang.Override
    public boolean equals(final java.lang.Object o) {
        if (o == this) return true;
        if (!(o instanceof Controle)) return false;
        final Controle other = (Controle)o;
        if (!other.canEqual((java.lang.Object)this)) return false;
        final java.lang.Object this$id = this.getId();
        final java.lang.Object other$id = other.getId();
        if (this$id == null ? other$id != null : !this$id.equals(other$id)) return false;
        final java.lang.Object this$libelle = this.getLibelle();
        final java.lang.Object other$libelle = other.getLibelle();
        if (this$libelle == null ? other$libelle != null : !this$libelle.equals(other$libelle)) return false;
        final java.lang.Object this$objet = this.getObjet();
        final java.lang.Object other$objet = other.getObjet();
        if (this$objet == null ? other$objet != null : !this$objet.equals(other$objet)) return false;
        final java.lang.Object this$url = this.getUrl();
        final java.lang.Object other$url = other.getUrl();
        if (this$url == null ? other$url != null : !this$url.equals(other$url)) return false;
        if (this.isInitiativeDesGroupes() != other.isInitiativeDesGroupes()) return false;
        if (this.isCourDesComptes() != other.isCourDesComptes()) return false;
        if (this.getProgrammeCreation() != other.getProgrammeCreation()) return false;
        final java.lang.Object this$programmeReport = this.getProgrammeReport();
        final java.lang.Object other$programmeReport = other.getProgrammeReport();
        if (this$programmeReport == null ? other$programmeReport != null : !this$programmeReport.equals(other$programmeReport)) return false;
        final java.lang.Object this$dateCreation = this.getDateCreation();
        final java.lang.Object other$dateCreation = other.getDateCreation();
        if (this$dateCreation == null ? other$dateCreation != null : !this$dateCreation.equals(other$dateCreation)) return false;
        if (this.isCloture() != other.isCloture()) return false;
        if (this.isAvecRapport() != other.isAvecRapport()) return false;
        final java.lang.Object this$echeance = this.getEcheance();
        final java.lang.Object other$echeance = other.getEcheance();
        if (this$echeance == null ? other$echeance != null : !this$echeance.equals(other$echeance)) return false;
        final java.lang.Object this$groupePolitique = this.getGroupePolitique();
        final java.lang.Object other$groupePolitique = other.getGroupePolitique();
        if (this$groupePolitique == null ? other$groupePolitique != null : !this$groupePolitique.equals(other$groupePolitique)) return false;
        final java.lang.Object this$organismes = this.getOrganismes();
        final java.lang.Object other$organismes = other.getOrganismes();
        if (this$organismes == null ? other$organismes != null : !this$organismes.equals(other$organismes)) return false;
        final java.lang.Object this$lois = this.getLois();
        final java.lang.Object other$lois = other.getLois();
        if (this$lois == null ? other$lois != null : !this$lois.equals(other$lois)) return false;
        final java.lang.Object this$livrables = this.getLivrables();
        final java.lang.Object other$livrables = other.getLivrables();
        if (this$livrables == null ? other$livrables != null : !this$livrables.equals(other$livrables)) return false;
        final java.lang.Object this$acteurs = this.getActeurs();
        final java.lang.Object other$acteurs = other.getActeurs();
        if (this$acteurs == null ? other$acteurs != null : !this$acteurs.equals(other$acteurs)) return false;
        final java.lang.Object this$themes = this.getThemes();
        final java.lang.Object other$themes = other.getThemes();
        if (this$themes == null ? other$themes != null : !this$themes.equals(other$themes)) return false;
        return true;
    }

    public boolean canEqual(final java.lang.Object other) {
        return other instanceof Controle;
    }

    @java.lang.Override
    public int hashCode() {
        final int PRIME = 59;
        int result = 1;
        final java.lang.Object $id = this.getId();
        result = result * PRIME + ($id == null ? 0 : $id.hashCode());
        final java.lang.Object $libelle = this.getLibelle();
        result = result * PRIME + ($libelle == null ? 0 : $libelle.hashCode());
        final java.lang.Object $objet = this.getObjet();
        result = result * PRIME + ($objet == null ? 0 : $objet.hashCode());
        final java.lang.Object $url = this.getUrl();
        result = result * PRIME + ($url == null ? 0 : $url.hashCode());
        result = result * PRIME + (this.isInitiativeDesGroupes() ? 79 : 97);
        result = result * PRIME + (this.isCourDesComptes() ? 79 : 97);
        result = result * PRIME + this.getProgrammeCreation();
        final java.lang.Object $programmeReport = this.getProgrammeReport();
        result = result * PRIME + ($programmeReport == null ? 0 : $programmeReport.hashCode());
        final java.lang.Object $dateCreation = this.getDateCreation();
        result = result * PRIME + ($dateCreation == null ? 0 : $dateCreation.hashCode());
        result = result * PRIME + (this.isCloture() ? 79 : 97);
        result = result * PRIME + (this.isAvecRapport() ? 79 : 97);
        final java.lang.Object $echeance = this.getEcheance();
        result = result * PRIME + ($echeance == null ? 0 : $echeance.hashCode());
        final java.lang.Object $groupePolitique = this.getGroupePolitique();
        result = result * PRIME + ($groupePolitique == null ? 0 : $groupePolitique.hashCode());
        final java.lang.Object $organismes = this.getOrganismes();
        result = result * PRIME + ($organismes == null ? 0 : $organismes.hashCode());
        final java.lang.Object $lois = this.getLois();
        result = result * PRIME + ($lois == null ? 0 : $lois.hashCode());
        final java.lang.Object $livrables = this.getLivrables();
        result = result * PRIME + ($livrables == null ? 0 : $livrables.hashCode());
        final java.lang.Object $acteurs = this.getActeurs();
        result = result * PRIME + ($acteurs == null ? 0 : $acteurs.hashCode());
        final java.lang.Object $themes = this.getThemes();
        result = result * PRIME + ($themes == null ? 0 : $themes.hashCode());
        return result;
    }

    @java.lang.Override
    public java.lang.String toString() {
        return "Controle(id=" + this.getId() + ", libelle=" + this.getLibelle() + ", objet=" + this.getObjet() + ", url=" + this.getUrl() + ", initiativeDesGroupes=" + this.isInitiativeDesGroupes() + ", courDesComptes=" + this.isCourDesComptes() + ", programmeCreation=" + this.getProgrammeCreation() + ", programmeReport=" + this.getProgrammeReport() + ", dateCreation=" + this.getDateCreation() + ", cloture=" + this.isCloture() + ", avecRapport=" + this.isAvecRapport() + ", echeance=" + this.getEcheance() + ")";
    }
}
				</code></pre>
					<aside class="notes">
						<ul>Une classe JPA assez touffue avec
							<li>du code métier</li>
							<li>des getters (dont un <em>à la demande</em>) et des setters</li>
							<li>un constructeur "minimal" (arguments finaux non définis)</li>
							<li>des classes utilitaires (<code>toString</code>, <code>equals</code>, <code>hashCode</code>)</li>
							<li>la valeur ajoutée est noyée</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-calm.jpg">
					<h2>Utilisation</h2>
					<pre><code>
						&lt;dependency>
						&nbsp;&nbsp;&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
						&nbsp;&nbsp;&lt;artifactId&gt;lombok&lt;/artifactId&gt;
						&nbsp;&nbsp;&lt;version&gt;1.12.6&lt;/version&gt;
						&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;
						&lt;/dependency&gt;
					</code></pre>
					<aside class="notes">
						<ul>
							<li>si pas Netbeans : installation (via <code>lombok.jar</code> ou plugin)</li>
							<li>le <code>jar</code> dans le <code>CLASSPATH</code> lors de la compilation est suffisant</li>
							<li>rien au runtime</li>
						</ul>
					</aside>
				</section>

				<section>
					<h2>Les plus simples</h2>
					<ul lang="en">
						<li><code>@ToString</code></li>
						<li class="fragment"><code>@EqualsAndHashCode</code></li>
						<li class="fragment"><code>@Getter<span class="fragment">(lazy=true)</span></code></li>
						<li class="fragment"><code>@Setter</code></li>
						<li class="fragment"><code>@RequiredArgsConstructor</code></li>
						<li class="fragment"><code>@Data</code></li>
					</ul>
					<aside class="notes">
						<ul>
							<li><code>toString</code> classiquement utilisé pour le debug</li>
							<li>ces annotations sont <a hreflang="en" href="http://projectlombok.org/features/index.html">documentées</a> en ligne</li>
						</ul>
					</aside>
				</section>

<!--
				<section>
					<pre><code>
/**
 * Copyright Sénat.
 */
package fr.senat.model.dosleg;

import fr.senat.model.dosleg.validator.ActiviteValide;
import fr.senat.model.senateurs.GroupePolitique;
import fr.senat.util.Constants;
import java.io.Serializable;
import java.util.HashSet;
import java.util.Set;
import javax.persistence.CascadeType;
import javax.persistence.Column;
import javax.persistence.Embedded;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.JoinTable;
import javax.persistence.ManyToMany;
import javax.persistence.ManyToOne;
import javax.persistence.OneToMany;
import javax.persistence.OrderBy;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Pattern;
import javax.validation.constraints.Size;
import lombok.Data;
import lombok.ToString;
import org.hibernate.annotations.Type;
import static org.joda.time.DateTimeConstants.OCTOBER;
import org.joda.time.LocalDate;
import static org.joda.time.LocalDate.now;

/**
 * Représente une mission de contrôle et d'évaluation du Sénat. Peut être une Mission Commune d'Information, une
 * commission d'enquête, un contrôle d'application d'une loi, un contrôle de commission permanente, etc... Par défaut,
 * le contrôle n'est à l'initiative des groupes, ni avec l'aide de la cour des comptes ou clôturé, mais il est considéré
 * comme avec rapport. Par ailleurs, les organismes, lois, livrables, acteurs et thèmes sont des ensembles vides.
 */
@Entity
@Data
@ToString(exclude = {"organismes", "groupePolitique", "lois", "livrables",
    "acteurs", "themes"})
@ActiviteValide
public class Controle implements Serializable {

    private static final String FOREIGN_KEY_ID = "CON_ID";
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Integer id;
    @Size(max = 256, message = "trop long.")
    @Column(name = "LIB", length = 256)
    @NotNull
    private String libelle;
    @Size(max = 2048, message = "trop long.")
    private String objet;
    @Pattern(regexp = Constants.URL_PATTERN, message = "pas au bon format (par exemple : "
            + "http://www.senat.fr/commission/XX/missions_d_information/mission_dinformation_sur_YY.html)")
    private String url;
    @NotNull
    @Column(name = "INITIATIVE_GROUPES")
    @Type(type = "fr.senat.util.hibernate.usertype.OuiNonSmallType")
    private boolean initiativeDesGroupes = false;
    @NotNull
    @Column(name = "COUR_COMPTES")
    @Type(type = "fr.senat.util.hibernate.usertype.OuiNonSmallType")
    private boolean courDesComptes = false;
    @NotNull
    @Column(name = "PROGRAMME_CREATION")
    private int programmeCreation = Controle.getSession(now());
    @Column(name = "PROGRAMME_REPORT")
    private Integer programmeReport;
    @Column(name = "DATE_CREATION")
    @Type(type = "org.jadira.usertype.dateandtime.joda.PersistentLocalDate")
    private LocalDate dateCreation;
    @NotNull
    @Type(type = "fr.senat.util.hibernate.usertype.OuiNonSmallType")
    private boolean cloture = false;
    @NotNull
    @Column(name = "AVEC_RAPPORT")
    @Type(type = "fr.senat.util.hibernate.usertype.OuiNonSmallType")
    private boolean avecRapport = true;
    @Embedded
    @NotNull
    private EcheanceControle echeance = new EcheanceControle();
    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "GRPPOL")
    private GroupePolitique groupePolitique;
    @ManyToMany
    @JoinTable(name = "CONTROLE_ORG", joinColumns
            = @JoinColumn(name = FOREIGN_KEY_ID), inverseJoinColumns
            = @JoinColumn(name = "ORGCOD"))
    private Set<Organisme> organismes = new HashSet<Organisme>();
    @ManyToMany
    @JoinTable(name = "CONTROLE_LOI", joinColumns
            = @JoinColumn(name = FOREIGN_KEY_ID), inverseJoinColumns
            = @JoinColumn(name = "LOICOD"))
    private Set<Loi> lois = new HashSet<Loi>();
    @OneToMany(orphanRemoval = true, cascade = CascadeType.ALL)
    @JoinColumn(name = FOREIGN_KEY_ID, nullable = false)
    private Set<LivrableControle> livrables = new HashSet<LivrableControle>();
    @OneToMany(orphanRemoval = true, cascade = CascadeType.ALL)
    @JoinColumn(name = FOREIGN_KEY_ID, nullable = false)
    @OrderBy("id asc")
    private Set<ActeurControle> acteurs = new HashSet<ActeurControle>();
    @Getter(lazy=true)
    private final Set<Theme> themes = Cache.getInstance().calculateThemes();

    /**
     * Renvoie la date à prendre en compte pour le nommage du groupe politique lié à ce contrôle. TODO vérifier cette
     * règle de gestion avec S. Dubourg.
     *
     * @return la date à prendre en compte.
     */
    private LocalDate getDateNommageGroupePolitique() {
        if (isClosed()) {
            return echeance.getDate();
        } else {
            return LocalDate.now();
        }
    }

    /**
     * Renvoie le libellé de groupe politique à la date adéquate pour ce contrôle, préfixé de l'article adéquat. Ainsi,
     * un contrôle en cours prendra le nom à la date du jour alors qu'un contrôle fini prendra le nom à la date
     * d'échéance.
     *
     * @return le libellé préfixé de l'article. <code>null</code> si le groupe politique n'est pas défini.
     */
    public String getLibelleLongEtArticleGroupePolitique() {
        if (groupePolitique != null) {
            LocalDate d = getDateNommageGroupePolitique();
            StringBuilder sb = new StringBuilder(groupePolitique.getArticle(d));
            sb.append(" ");
            sb.append(groupePolitique.getLibelleLong(d));
            return sb.toString();
        }
        return null;
    }

    /**
     * Détermine si le contrôle est fini.
     *
     * @return <code>true</code> si le contrôle est fini.
     */
    public boolean isClosed() {
        return echeance != null && echeance.getDate().isBefore(LocalDate.now());
    }

    /**
     * Reporte d'un an le contrôle. La date de début d'activité est inchangée mais la date de report est décalée d'un an
     * (année suivant le démarrage si c'est le premier report)
     */
    public void reporter() {
        if (canReporteControle()) {
            if (programmeReport == null) {
                programmeReport = programmeCreation + 1;
            } else {
                programmeReport++;
            }
        }
    }

    /**
     * Renvoie le dernier programme d'activité du contrôle.
     *
     * @return le dernier programme d'activité du contrôle.
     */
    public int getDernierProgramme() {
        if (programmeReport == null) {
            return programmeCreation;
        } else {
            return programmeReport;
        }
    }

    /**
     * Indique si un contrôle peut être reporté. C'est le cas si l'échéance correspond à une session strictement
     * postérieure supérieure à la session de report actuelle.
     *
     * @return <code>true</code> si le contrôle peut être reporté. <code>false</code> sinon.
     */
    public boolean canReporteControle() {
        if (echeance.getDate() != null) {
            return (getDernierProgramme() < echeance.getSession());
        } else {
            return false;
        }
    }

    /**
     * Renvoie la session correspondant à une date.
     *
     * @param date la date dont on cherche la session.
     * @return la session, représentée par l'année de démarrage de la session (2013 pour la session 2013-2014 par
     * exemple). <code>null</code> si la date en paramètre est nulle.
     */
    public static Integer getSession(LocalDate date) {
        if (date != null) {
            if (date.getMonthOfYear() < OCTOBER) {
                return date.getYear() - 1;
            } else {
                return date.getYear();
            }
        } else {
            return null;
        }
    }

    /**
     * Renvoie l'année de fin d'activité du contrôle.
     *
     * @return l'année de fin d'activité.
     */
    public int getFinActivite() {
        return getDernierProgramme() + 1;
    }

    /**
     * Définit la fin d'activité. Calcule le programme correspondant et définit éventuellement un report sur le
     * contrôle.
     *
     * @param fin l'année de fin d'activité spécifiée dans le formulaire.
     */
    public void setFinActivite(int fin) {
        if (fin > getProgrammeCreation() + 1) {
            setProgrammeReport(fin - 1);
        } else {
            setProgrammeReport(null);
        }
    }
}
					</code></pre>
				</section>
-->

				<section data-background="img/slide-fireworks.jpg" data-state="code-extracts">
					<h2>Gain</h2>
					<p>
						<img alt="avant : 481 lignes de code" src="img/java-before.png"/>
						<img alt="après : 234 lignes de code concentrées sur la valeur ajoutée" src="img/java-after.png"/>
					</p>
					<aside class="notes">
						<ul>
							<li>diviser par 2 les lignes de code</li>
							<li>se concentrer sur la valeur ajoutée (le différenciateur)</li>
						</ul>
					</aside>
				</section>

				<section>
					<h2>D'autres exemples</h2>
					<ul>
						<li><code>@Delegate</code></li>
						<li class="fragment"><code>@Value</code></li>
						<li class="fragment"><code>@Log</code></li>
						<li class="fragment"><code>@Builder</code>
					</ul>
					<pre class="fragment"><code>SuperHero.builder().name("Superman").from("Krypton").alias("Clark").build();</code></pre></li>
					<aside class="notes">
						<ul>
							<li>déléguer l'exécution d'une partie des tâches. classique en objet. plomberie lourde</li>
							<li>classe immutable sans risque d'oubli, et bien documentée</li>
							<li>pas besoin de se rappeler de la ligne à écrire, et cohérence des clés</li>
							<li>interface fluide d'instanciation</li>
							<li>16 <a hreflang="en" href="http://projectlombok.org/features/">stables</a>, 6 <a hreflang="en" href="http://projectlombok.org/features/experimental/">expérimentaux (officiels)</a>, 30 <a hreflang="en" href="https://github.com/peichhorn/lombok-pg">playground (externes)</a> ou perso</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-warning.jpg" data-state="light-background">
					<h2>Points d'attention</h2>
					<aside class="notes">
						<ul>
							<li>mise en place échelonnée pour comprendre les impacts (<code>delombok</code> si problème)</li>
							<li>code moins maîtrisé : <code lang="en">StackOverflow</code> avec <code>@toString</code> par <abbr title="exemple">ex.</abbr></li>
							<li>penser au <code>exclude</code> dans ce cas-là</li>
							<li>debug difficile : rester sur le testé</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-ok.jpg">
					<h2>Maintenabilité</h2>
					<blockquote>Exprimer l'intention</blockquote>
					<aside class="notes">
						<ul>
							<li>Code plus sûr, plus lisible</li>
							<li>Concentré sur la valeur ajoutée</li>
							<li>Les annotations permettent d'exprimer l'intention plutôt que l'implémentation</li>
							<li>Clé de la maintenabilité</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-beer.jpg" data-state="light-background">
					<h2>Crédits</h2>
					<ul>
						<li><em>Logiciels</em> : 
							<a hreflang="en" href="http://lab.hakim.se/reveal-js/">reveal.js</a>, 
							<a hreflang="en" href="http://simpleicons.org/">simple icons</a>
						</li>
						<li><em>Photos</em> : 
							<a hreflang="en" href="https://secure.flickr.com/photos/abee5/8314929977/">Abhi Sharma</a>, 
							<a hreflang="en" href="https://secure.flickr.com/photos/fadilfb/512828077/">Fadil Basymeleh</a>,
							<a hreflang="en" href="http://www.linkedin.com/in/florentmathe">Florent Mathé</a>,
							<a hreflang="en" href="http://frank.itlab.us/photo_essays/wrapper.php?feb_14_2009_mapur.html">Frank Starmer</a>, 
							<a hreflang="en" href="https://secure.flickr.com/photos/unavoidablegrain/4070656943/">Greg Borenstein</a>, 
							<a hreflang="en" href="https://commons.wikimedia.org/wiki/File:Gadget_the_pug_expressive_eyes.jpg">Joseph Matthew Miller</a>, 
							<a hreflang="en" href="https://secure.flickr.com/photos/indoloony/3062470964/">Joy Banerjee</a>, 
							<a hreflang="en" href="https://commons.wikimedia.org/wiki/File:Electricity_warning_sign_in_Spain.jpg">Lali Masriera</a>, 
							<a hreflang="en" href="https://secure.flickr.com/photos/sumofmarc/6315756873/">Marc</a>, 
							<a hreflang="en" href="https://en.wikipedia.org/wiki/File:Wea00816.jpg" lang="en">U.S. National Oceanic and Atmospheric Administration</a>
						</li>
					</ul>
					<aside class="notes">
						<ul>
							<li>si dans la salle, je leur paie une bière non virtuelle</li>
							<li>dans le même esprit de partage, partagé sur github</li>
						</ul>
					</aside>
				</section>

				<section data-background="img/slide-dingle.jpg">
		            <h2>Merci</h2>
		            <ul>
		              <li class="email"><a href="mailto:laurent@cottereau.name"><code>laurent@cottereau.name</code></a></li>
		              <li class="twitter"><a href="https://twitter.com/lcottereau"><code>@lcottereau</code></a></li>
		              <li class="linkedin"><a href="http://fr.linkedin.com/in/lcottereau/fr"><code>lcottereau</code></a></li>
		              <li class="github"><a hreflang="en" href="https://github.com/lcottereau"><code>lcottereau</code></a></li>
		            </ul>
				</section>

			</div>

		</div>

		<script src="reveal/lib/js/head.min.js"></script>
		<script src="reveal/js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: false,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
				backgroundTransition: 'slide',

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'reveal/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'reveal/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'reveal/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
